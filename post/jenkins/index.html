<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://koko-club.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="æ˜¥é£å¾—æ„é©¬è¹„ç–¾ï¼Œä¸€æ—¥çœ‹å°½é•¿å®‰èŠ±"><meta charset="UTF-8"><title>jenkins | Imcry</title>
<link href="https://koko-club.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://koko-club.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://koko-club.github.io/post/jenkins/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://koko-club.github.io"><img alt="logo" style="display:inline-block;" src="https://koko-club.github.io/images/avatar.png"/></a><h1 title="Imcry" class="weaklink"><a  href="/">Imcry</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1677484698183" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>jenkins</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2023-02-20</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px"></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">4172å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">17 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<h1 id="jenkins">jenkins</h1>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„ã€æä¾›å‹å¥½æ“ä½œç•Œé¢çš„æŒç»­é›†æˆ(CI)å·¥å…·ï¼Œèµ·æºäºHudsonï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•è½¯ä»¶é¡¹ç›®ã€ç›‘æ§å¤–éƒ¨ä»»åŠ¡çš„è¿è¡Œã€‚Jenkinsç”¨Javaè¯­è¨€ç¼–å†™ï¼Œå¯åœ¨Tomcatç­‰æµè¡Œçš„servletå®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ç‹¬ç«‹è¿è¡Œã€‚é€šå¸¸ä¸ç‰ˆæœ¬ç®¡ç†å·¥å…·(SCM)ã€æ„å»ºå·¥å…·ç»“åˆä½¿ç”¨ã€‚å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·æœ‰SVNã€GITï¼Œæ„å»ºå·¥å…·æœ‰Mavenã€Antã€Gradleã€‚</p>
<p>jenkinså®˜ç½‘ï¼šhttps://www.jenkins.io/</p>
<h3 id="æŒç»­é›†æˆci">æŒç»­é›†æˆCI</h3>
<p>æŒç»­é›†æˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œå³å›¢é˜Ÿå¼€å‘æˆå‘˜ç»å¸¸é›†æˆä»–ä»¬çš„å·¥ä½œï¼Œé€šå¸¸æ¯ä¸ªæˆå‘˜æ¯å¤©è‡³å°‘é›†æˆä¸€æ¬¡ï¼Œä¹Ÿå°±æ„å‘³ç€æ¯å¤©å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡é›†æˆã€‚æ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºï¼ˆåŒ…æ‹¬<a href="https://baike.baidu.com/item/%E7%BC%96%E8%AF%91/1258343?fromModule=lemma_inlink">ç¼–è¯‘</a>ï¼Œå‘å¸ƒï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰æ¥éªŒè¯ï¼Œä»è€Œå°½æ—©åœ°å‘ç°é›†æˆé”™è¯¯ã€‚</p>
<p>é€šä¿—æ¥è®²æŒç»­é›†æˆå°±æ˜¯è½¯ä»¶å¼€å‘äººå‘˜æäº¤ä»£ç ä»¥åè‡ªåŠ¨åŒ–æ„å»ºã€å‘å¸ƒã€æµ‹è¯•ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://koko-club.github.io/post-images/jenkins/webp.webp" alt="img" loading="lazy"></figure>
<h3 id="æŒç»­äº¤ä»˜cd">æŒç»­äº¤ä»˜CD</h3>
<p>CD(Continuous Deliveryï¼Œ ä¸­æ–‡æ„æ€æŒç»­äº¤ä»˜)æ˜¯åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šï¼Œå°†é›†æˆåçš„ä»£ç éƒ¨ç½²åˆ°æ›´è´´è¿‘çœŸå®è¿è¡Œç¯å¢ƒ(ç±»ç”Ÿäº§ç¯å¢ƒ)ä¸­ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å®Œæˆå•å…ƒæµ‹è¯•åï¼Œå¯ä»¥æŠŠä»£ç éƒ¨ç½²åˆ°è¿æ¥æ•°æ®åº“çš„Stagingç¯å¢ƒä¸­æ›´å¤šçš„æµ‹è¯•ã€‚å¦‚æœä»£ç æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ä¸‹å›¾ååº”çš„æ˜¯CI/CD çš„å¤§æ¦‚å·¥ä½œæ¨¡å¼ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https:////upload-images.jianshu.io/upload_images/6464255-ba088ec7257062c0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt="img" loading="lazy"></figure>
<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<p>éƒ¨ç½²æ–¹å¼ä¸€èˆ¬ç°åœ¨å°±åˆ†ä¸ºäºŒè¿›åˆ¶éƒ¨ç½²å’Œdocker(k8s)éƒ¨ç½²ã€‚</p>
<p>å®˜ç½‘ä¸‹è½½ï¼šhttps://www.jenkins.io/download/</p>
<h3 id="äºŒè¿›åˆ¶åŒ…éƒ¨ç½²">äºŒè¿›åˆ¶åŒ…éƒ¨ç½²</h3>
<p>jenkinsæœ¬èº«æ˜¯åŸºäºjavaå¼€å‘ï¼Œå…¶äºŒè¿›åˆ¶åŒ…æ˜¯waræ–‡ä»¶ï¼Œè¿è¡Œäºtomcatã€‚</p>
<p>1.éƒ¨ç½²tomcat</p>
<p>2.ä¸‹è½½jenkinsçš„waréƒ¨ç½²åŒ…</p>
<p>3.å°†åŒ…æ”¾äºtomcatçš„webappsç›®å½•ä¸‹ï¼Œå¯åŠ¨tomcatã€‚é»˜è®¤8080ç«¯å£è®¿é—®ã€‚</p>
<h3 id="k8sdockeréƒ¨ç½²">k8s(docker)éƒ¨ç½²</h3>
<h4 id="dockeréƒ¨ç½²">dockeréƒ¨ç½²</h4>
<p>dockeruhbå®˜ç½‘é•œåƒåœ°å€ï¼šhttps://hub.docker.com/r/jenkins/jenkins</p>
<p>1.æ‹‰å–é•œåƒ	docker pull jenkins/jenkins</p>
<p>2.åœ¨æœ¬åœ°åˆ›å»ºJenkins-homeç›®å½•ï¼šmkdir -p /home/jenkins_home ç”¨äºæ˜ å°„</p>
<p>3.å¯åŠ¨Jenkinså®¹å™¨ï¼šdocker run -d --name jenkins -p 8080:8080 -p 50000:50000 -v /home/jenkins_home:/var/jenkins_home jenkins/jenkins</p>
<p>â€‹	-p 50000:50000 ï¼Œ<code>è¿™ä¸ªç«¯å£æ˜ å°„è¦ä¿æŒä¸€è‡´</code>ï¼Œå¦åˆ™agentæ— æ³•å¯åŠ¨ï¼Œagentéƒ¨åˆ†ä¸»è¦ä½œç”¨å°±æ˜¯å‘Šè¯‰Jenkins,é€‰æ‹©å“ªå°èŠ‚ç‚¹æœºå™¨å»æ‰§è¡ŒPipelineä»£ç </p>
<p>4ã€ç„¶åç½‘ç«™ä¸Šè¾“å…¥IP:8080è®¿é—®ï¼Œéœ€è¦è¾“å…¥å¯†ç ï¼Œå¤åˆ¶é¡µé¢ä¸Šçš„è·¯å¾„ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¾“å…¥cat è·¯å¾„æŸ¥çœ‹å¯†ç ï¼Œç²˜è´´åˆ°è¾“å…¥æ¡†ä¹‹åä¸‹ä¸€æ­¥å°±å¥½</p>
<p>â€‹	cat / var/jenkins_home/secrets/initialadminpassword</p>
<h4 id="k8séƒ¨ç½²">k8séƒ¨ç½²</h4>
<p>k8sä¸Šé¢ä¸€èˆ¬æœ‰ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œä½¿ç”¨yamlæ–‡ä»¶éƒ¨ç½²å’Œhelmæ–¹å¼éƒ¨ç½²ã€‚</p>
<h5 id="helmæ–¹å¼">helmæ–¹å¼</h5>
<p>helmæ–¹å¼å»ºè®®ä½¿ç”¨å®˜æ–¹é•œåƒï¼Œè¿™é‡Œå¦‚æœç”¨çš„æ˜¯bitnamiçš„é•œåƒåˆ™å»ºè®®æ›¿æ¢æˆå®˜æ–¹ï¼Œæˆ‘è¿™è¾¹ä½¿ç”¨å‘ç°bitnamiçš„jenkinsæœ‰äº›ç³»ç»Ÿé…ç½®æ— æ³•æŒä¹…åŒ–ã€‚</p>
<pre><code>helm repo add jenkins  https://charts.jenkins.io      
helm pull jenkins  https://charts.jenkins.io    
tar -xvf jenkins-VERSION.tar.gz
cd jenkins
vim values.yaml
#æ ¹æ®éœ€æ±‚æ›´æ”¹é…ç½®
é‡è¦çš„é…ç½®åŒ…æ‹¬jenkinså¯†ç ï¼Œsvcç±»å‹ï¼ŒjenkinsæŒä¹…åŒ–å­˜å‚¨é…ç½®ï¼ˆPVCï¼‰
æ”¹å®Œä»¥å
helm install jenkins . -n è¦éƒ¨ç½²çš„åç§°ç©ºé—´
</code></pre>
<h5 id="yamléƒ¨ç½²">yamléƒ¨ç½²</h5>
<p>jenkins.yaml:</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: jks
spec:
  replicas: 1
  selector:
    matchLabels:
      app: jks
  template:
    metadata:
      labels:
        app: jks
    spec:
      containers:
      - name: jks
        image: jenkins/jenkins:2.319.3-centos7-jdk8
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: jks-home
          mountPath: /var/jenkins_home
        - name: time-zone                            #å®¹å™¨å†…æŒ‚è½½ç‚¹åç§°
          mountPath: /etc/localtime              #å®¹å™¨å†…æŒ‚è½½ç‚¹è·¯å¾„ï¼Œå¯ä»¥æ˜¯æ–‡ä»¶æˆ–ç›®å½•
      affinity: #è¿™é‡Œç”±äºjenkinsé•œåƒå¾ˆå¤§ï¼Œé¿å…åˆ æ‰podé‡æ„åˆ‡æ¢èŠ‚ç‚¹åˆè¦æ‹‰å–æ•°æ®ï¼Œæ‰€ä»¥å›ºå®šå…¶èŠ‚ç‚¹ã€‚
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/hostname # æ ‡ç­¾é”®å
                operator: In
                values:
                - node2 
      initContainers:
      - args:
        - -c
        - chmod 755 /var/jenkins_home &amp;&amp; chown 1000:1000 /var/jenkins_home   ### è¿™é‡Œå°†ä¸Šä¸€æ­¥æ‰€è®°å½•çš„æƒé™å±ç»„è¿›è¡Œæ›´æ”¹
        command:
        - /bin/sh
        image: centos
        imagePullPolicy: IfNotPresent
        name: chauth
        securityContext:
          privileged: true    ###  å»ºè®®å¼€å¯ç‰¹æƒæ¨¡å¼
        volumeMounts:
        - mountPath: /var/jenkins_home      ### initcä¹Ÿè¦å¯¹æ¬¡æ•°æ®å·è¿›è¡ŒæŒ‚è½½
          name: jks-home
      volumes:
      - name: time-zone                              #æ•°æ®å·åç§°ï¼Œéœ€è¦ä¸å®¹å™¨å†…æŒ‚è½½ç‚¹åç§°ä¸€è‡´
        hostPath:
          path: /etc/localtime  
      - name: jks-home
        persistentVolumeClaim:
            claimName: jks-pvc
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: jks-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
---
apiVersion: v1
kind: Service
metadata:
  name: jks
spec:
  selector:
    app: jks
  type: NodePort
  ports:
    - port: 8080
      targetPort: 8080
      nodePort: 32089

</code></pre>
<p>kubectl apply -f jenkins.yaml</p>
<p>éƒ¨ç½²å®Œåè®¿é—®jenkins:</p>
<figure data-type="image" tabindex="3"><img src="https://koko-club.github.io/post-images/jenkins/image-20230215154224734.png" alt="image-20230215154224734" loading="lazy"></figure>
<p>è¿™é‡Œè¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œè¿›å…¥å®¹å™¨æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶</p>
<pre><code>[root@node1 jenkins_test]# kubectl exec -it jks-698b6564fb-5692t -n k3s-test bash 
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
Defaulted container &quot;jks&quot; out of: jks, chauth (init)
bash-4.2$ cat /var/jenkins_home/secrets/initialAdminPassword
54c0b40b20f34b4ca7b75840c68883a1
ç„¶åå¡«å…¥ç®¡ç†å‘˜å¯†ç å°±ok
å®‰è£…çš„æ’ä»¶å¦‚æœä¸çŸ¥é“å¯ä»¥å…ˆé€‰æ‹©æ¨èå®‰è£…çš„æ’ä»¶
</code></pre>
<h2 id="ä»»åŠ¡">ä»»åŠ¡</h2>
<p>jenkinsä¸»è¦å°±æ˜¯é€šè¿‡æ‰§è¡Œä»»åŠ¡æ¥å·¥ä½œçš„ï¼Œå·¦è¾¹èœå•ç¬¬ä¸€ä¸ªæŒ‰é’®å°±æ˜¯æ–°å»ºitem</p>
<figure data-type="image" tabindex="4"><img src="https://koko-club.github.io/post-images/jenkins/image-20230215164410954.png" alt="image-20230215164410954" loading="lazy"></figure>
<p>ä¸»è¦ä½¿ç”¨çš„å°±æ˜¯è‡ªç”±é¡¹ç›®ã€æµæ°´çº¿ã€å¤šåˆ†æ”¯æµæ°´çº¿ï¼Œè€Œä»ä»»åŠ¡ç±»å‹è§’åº¦æ¥è®²ä¸»è¦å°±åˆ†ä¸ºä¸¤ç§ï¼šæµæ°´çº¿ä¸éæµæ°´çº¿</p>
<h3 id="éæµæ°´çº¿è‡ªç”±é£æ ¼">éæµæ°´çº¿ï¼ˆè‡ªç”±é£æ ¼ï¼‰</h3>
<p>ä¸€èˆ¬ä»»åŠ¡çš„æ­¥éª¤åˆ†ä¸ºï¼šæ¨é€ä»£ç -ã€‹è§¦å‘é’©å­-ã€‹jenkinsä»»åŠ¡æ‰§è¡Œ-ã€‹æ‹‰å–ä»£ç -ã€‹æ„å»ºæ“ä½œ-ã€‹æ„å»ºåæ“ä½œï¼ˆä¸€èˆ¬æ˜¯é€šçŸ¥ï¼‰</p>
<h4 id="æ‹‰å–ä»£ç ">æ‹‰å–ä»£ç </h4>
<p>è¿™é‡Œä»æ‹‰å–ä»£ç å¼€å§‹ï¼š</p>
<p>é¦–å…ˆåœ¨åˆ›å»ºfreestyle projectå‰éœ€è¦å…ˆä¸‹è½½<a href="https://plugins.jenkins.io/git-parameter">Git Parameter</a>æ¨¡å—ï¼Œåœ¨ç³»ç»Ÿç®¡ç†â€”ã€‹æ’ä»¶ç®¡ç†â€”ã€‹å¯é€‰æ’ä»¶ä¸­æœç´¢git parameterï¼Œä¸‹è½½å¹¶é‡å¯jenkinsã€‚</p>
<p>æ–°å»ºä»»åŠ¡åœ¨æºç ç®¡ç†ä¸­é€‰æ‹©gitï¼ŒRepository URLè¾“å…¥gitä»“åº“åœ°å€ï¼ŒCredentialsæ·»åŠ ä¸€ä¸ªå…¨å±€å‡­æ®ç”¨äºgitç™»å½•ï¼ŒæŒ‡å®šåˆ†æ”¯ä¸­é€‰æ‹©è¦æ‹‰å–çš„åˆ†æ”¯ã€‚</p>
<h4 id="æ„å»ºè§¦å‘å™¨">æ„å»ºè§¦å‘å™¨</h4>
<p>æ„å»ºè§¦å‘å™¨ä¸€èˆ¬ç”¨äºåœ¨ä»£ç ä»“åº“æ¨é€ä»£ç ä¹‹åï¼Œè§¦å‘è§¦å‘å™¨ç„¶åjenkinså¼€å§‹æ„å»ºå¯¹åº”çš„ä»»åŠ¡ã€‚è¿™ä¸ªéœ€è¦<a href="https://plugins.jenkins.io/generic-webhook-trigger">Generic Webhook Trigger</a>æ’ä»¶ï¼Œå®‰è£…å®Œæ¯•é‡å¯å³å¯ã€‚</p>
<h5 id="webhookè§¦å‘jenkinsä»»åŠ¡é…ç½®">webhookè§¦å‘jenkinsä»»åŠ¡é…ç½®</h5>
<p>é¦–å…ˆéœ€è¦åœ¨jenkinsä»»åŠ¡ä¸­é…ç½®è§¦å‘å™¨</p>
<figure data-type="image" tabindex="5"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216111031873.png" alt="image-20230216111031873" loading="lazy"></figure>
<p>ä¾‹å¦‚è¿™é‡Œçš„tokenè®¾ç½®çš„æ˜¯testï¼Œåˆ™è§¦å‘å™¨urlä¸ºï¼šhttp://jenkins/generic-webhook-trigger/invok?token=test</p>
<p>ä¸€èˆ¬ä»£ç ä»“åº“å¦‚gitlabéƒ½ä¼šåœ¨å…·ä½“é¡¹ç›®é‡Œé¢æœ‰webhooké…ç½®ï¼Œå¦‚ä¸‹</p>
<figure data-type="image" tabindex="6"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216110814851.png" alt="image-20230216110814851" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216110830102.png" alt="image-20230216110830102" loading="lazy"></figure>
<p>é¦–å…ˆå°†åˆšåˆšè®¾ç½®æ‹¿åˆ°çš„è§¦å‘å™¨urlå¡«å…¥è¿™ä¸ªURLä¸­ï¼Œç„¶åè®¾ç½®è§¦å‘çš„åŠ¨ä½œï¼Œä¸€èˆ¬push eventså³å¯ï¼Œè¡¨ç¤ºå…¶æ”¶åˆ°pushæ“ä½œæ—¶ï¼Œåˆ™ä¼šè§¦å‘ã€‚åˆ°è¿™é‡Œwebhookè§¦å‘å™¨å°±é…ç½®å®Œæˆäº†ï¼Œå½“gitlabæ¨é€ä»£ç æ—¶ï¼Œjenkinsä¼šç«‹å³æ‰§è¡Œå¯¹åº”é¡¹ç›®çš„ä»»åŠ¡ã€‚</p>
<h4 id="æ„å»ºç¯å¢ƒ">æ„å»ºç¯å¢ƒ</h4>
<p>æ„å»ºç¯å¢ƒä¸»è¦æ„å»ºå‰çš„ä¸€äº›æ“ä½œï¼Œä¾‹å¦‚æ„å»ºå‰åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ã€ä½¿ç”¨å¯†ç æ–‡ä»¶æˆ–æ–‡æœ¬ã€å¦‚æœå¡ä½åˆ™ç»ˆæ­¢æ„å»ºç­‰ã€‚è¿™ä¸ªé…ç½®ä¸æ˜¯å¿…è¦é…ç½®ï¼Œä¸€èˆ¬ä¸ç”¨å¯¹æ„å»ºç¯å¢ƒåšé…ç½®ã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216112310634.png" alt="image-20230216112310634" loading="lazy"></figure>
<h4 id="æ„å»º">æ„å»º</h4>
<p>æ„å»ºæœ€å¸¸ç”¨çš„å°±æ˜¯æ‰§è¡Œshellå‘½åï¼Œæ‹‰å–ä»£ç ä»¥åçš„ç¼–è¯‘-ã€‹æ‰“åŒ…æ¨é€dockeré•œåƒï¼ˆå¦‚æœä¸æ‰“åŒ…å°±æ˜¯äºŒè¿›åˆ¶éƒ¨ç½²ï¼‰-ã€‹éƒ¨ç½² æ“ä½œéƒ½åœ¨è¿™ä¸€æ­¥å®Œæˆã€‚</p>
<figure data-type="image" tabindex="9"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216112840235.png" alt="image-20230216112840235" loading="lazy"></figure>
<p>â€‹	<img src="https://koko-club.github.io/post-images/jenkins/image-20230216112904780.png" alt="image-20230216112904780" loading="lazy"></p>
<p>ç›´æ¥åœ¨é‡Œé¢æ‰§è¡Œshellå‘½ä»¤æˆ–è€…æ‰§è¡Œè„šæœ¬å°±è¡Œäº†ã€‚</p>
<h4 id="æ„å»ºåæ“ä½œ">æ„å»ºåæ“ä½œ</h4>
<p>æ„å»ºåå¸¸ç”¨é…ç½®æ˜¯æ„å»ºé€šçŸ¥ï¼Œä¸€èˆ¬å¸¸ç”¨çš„æ˜¯emailé€šçŸ¥ï¼Œjenkinsé»˜è®¤æ”¯æŒemailé€šçŸ¥</p>
<figure data-type="image" tabindex="10"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216113950123.png" alt="image-20230216113950123" loading="lazy"></figure>
<p>ä½†ç°åœ¨æ¯”è¾ƒæµè¡Œç”¨webhookè¿›è¡Œé€šçŸ¥ï¼Œjenkinsé»˜è®¤ä¸æ”¯æŒè¿™ç§é…ç½®ï¼Œéœ€è¦é¢å¤–ä¸‹è½½æ’ä»¶ã€‚</p>
<h5 id="ä¼ä¸šå¾®ä¿¡é€šçŸ¥">ä¼ä¸šå¾®ä¿¡é€šçŸ¥</h5>
<p>1ã€åœ¨éœ€è¦å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥çš„ç¾¤ä¸­â€œæ·»åŠ ç¾¤æœºå™¨äººâ€ï¼Œå¾—åˆ°webhookåœ°å€</p>
<p>2ã€åœ¨Jenkinsç³»ç»Ÿç®¡ç†-æ’ä»¶ç®¡ç†-å¯é€‰æ’ä»¶ï¼Œæœç´¢&quot;Qy Wechat Notification Plugin&quot;æ’ä»¶ï¼Œä¸‹è½½å¹¶é‡å¯Jenkins</p>
<p>3ã€é…ç½®ç³»ç»Ÿé…ç½®</p>
<p>â€‹		è¾“å…¥webhookåœ°å€ï¼Œç‚¹å‡»ä¿å­˜</p>
<figure data-type="image" tabindex="11"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216131115946.png" alt="image-20230216130625028" loading="lazy"></figure>
<p>å¡«å…¥webhookå³å¯ï¼Œå…¶ä»–å‡ é¡¹éå¿…å¡«é¡¹ã€‚</p>
<h5 id="é’‰é’‰é€šçŸ¥">é’‰é’‰é€šçŸ¥</h5>
<p>1ã€æ‰“å¼€é’‰é’‰ï¼Œè¿›å…¥ç¾¤è®¾ç½®-æ™ºèƒ½ç¾¤åŠ©æ‰‹-æ·»åŠ æœºå™¨äºº-è‡ªå®šä¹‰æœºå™¨äººï¼ˆå¡«å†™æœºå™¨äººåç§°ã€å®‰å…¨è®¾ç½®ã€åè®®ï¼‰å¾—åˆ°webhook</p>
<p>2ã€åœ¨Jenkinsç³»ç»Ÿç®¡ç†-æ’ä»¶ç®¡ç†-å¯é€‰æ’ä»¶ï¼Œæœç´¢â€œDingTalkâ€ï¼Œä¸‹è½½å¹¶é‡å¯Jenkins</p>
<p>3ã€é…ç½®ç³»ç»Ÿé…ç½®</p>
<p>è¿›å…¥ç³»ç»Ÿç®¡ç†-ç³»ç»Ÿé…ç½®-é’‰é’‰ï¼Œ è¾“å…¥webhookåœ°å€ã€idã€åç§°ï¼Œä¸»è¦æ˜¯webhookåœ°å€ä»¥åŠé’‰é’‰é‚£è¾¹æœºå™¨äººæ˜¯å¦é…ç½®äº†å…³é”®å­—å’ŒåŠ å¯†ï¼Œå¦‚æœæœ‰éœ€è¦è¾“å…¥<br>
<img src="https://koko-club.github.io/post-images/jenkins/image-20230216132900385.png" alt="image-20230216132900385" loading="lazy"></p>
<p>ç„¶ååœ¨ä»»åŠ¡é…ç½®ä¸­æœ€ä¸Šé¢å°±å¯ä»¥æ‰¾åˆ°é’‰é’‰æœºå™¨äºº</p>
<figure data-type="image" tabindex="12"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216133032694.png" alt="image-20230216133032694" loading="lazy"></figure>
<p>å¦‚æœä¸å¡«å†™å†…å®¹åˆ™ä¸ºæ’ä»¶é»˜è®¤çš„å‘Šè­¦æ¨¡å¼ï¼Œå¦‚éœ€è‡ªå®šä¹‰éœ€è¦çœ‹æ’ä»¶æ–‡æ¡£ã€‚</p>
<h4 id="mavenä»»åŠ¡">mavenä»»åŠ¡</h4>
<p>å¦‚æœæ˜¯javaé¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨mavené£æ ¼æ¥åˆ›å»ºä»»åŠ¡ã€‚é¦–å…ˆéœ€è¦æŒ‰<a href="https://plugins.jenkins.io/maven-plugin">Maven Integration plugin</a>æ’ä»¶ï¼Œå®‰è£…åé‡å¯åœ¨åˆ›å»ºä»»åŠ¡æ—¶å°±å¯ä»¥çœ‹åˆ°é€‰é¡¹</p>
<figure data-type="image" tabindex="13"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216133527267.png" alt="image-20230216133527267" loading="lazy"></figure>
<p>mavené£æ ¼é¡¹ç›®ä¸»è¦æ˜¯å¤šäº†ä¸€ä¸ªbuildé€‰é¡¹ï¼Œå¯ä»¥ç›´æ¥åœ¨é…ç½®ä¸­æŒ‡å®špom.xmlè¿›è¡Œmavenæ‰“åŒ…ï¼Œä¸åƒè‡ªç”±é£æ ¼ä¸€æ ·æ‰€æœ‰æ“ä½œéƒ½éœ€è¦é€šè¿‡shellæ¥æ‰§è¡Œã€‚è¿™é‡Œéœ€è¦å®‰è£…mavenå·¥å…·ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šæç¤ºæ‰¾ä¸åˆ°å·¥å…·ï¼Œéœ€è¦åœ¨å…¨å±€å·¥å…·é…ç½®ä¸­å®‰è£…æˆ–æŒ‡å®šå·¥å…·ç›®å½•ã€‚</p>
<figure data-type="image" tabindex="14"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216133703880.png" alt="image-20230216133703880" loading="lazy"></figure>
<h3 id="æµæ°´çº¿pipeline">æµæ°´çº¿ï¼ˆpipelineï¼‰</h3>
<p>æµæ°´çº¿å…¶å®å°±æ˜¯é€šè¿‡pipelineçš„æ–¹å¼æ¥é…ç½®ä»»åŠ¡æµç¨‹ã€‚</p>
<h4 id="pipelineè¯­æ³•">pipelineè¯­æ³•</h4>
<figure data-type="image" tabindex="15"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217104233727.png" alt="image-20230217104233727" loading="lazy"></figure>
<h5 id="pipelineç¤ºä¾‹">pipelineç¤ºä¾‹</h5>
<h6 id="ç¤ºä¾‹1">ç¤ºä¾‹1</h6>
<pre><code>pipeline {
	agent any

	stages{
		stage('è·å–ä»£ç ') {
			steps {
			
	      checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '4dc04ffd-15bf-46e3-a942-2b58f37bc26b', url: 'git@gitlab.zhangxianwei.com:dev/java.git']]])
			
			}
		}
		
		stage('ä»£ç æ£€æµ‹'){
			steps {
				echo &quot;sonarqube check....&quot;
			}
		}		
		stage('ä»£ç æ„å»º'){
			steps {
				echo &quot;maven build.....&quot;
			}
		}	
		stage('ä»£ç éƒ¨ç½²'){
			steps {
			    echo &quot;echo sh&quot;
			//	sh -x '/server/scripts/deploy_html_tag.sh'
			}
		}
	}
	
}
</code></pre>
<h6 id="javaé¡¹ç›®æ„å»ºpipelineç¤ºä¾‹">javaé¡¹ç›®æ„å»ºpipelineç¤ºä¾‹</h6>
<pre><code>pipeline {
    agent {
        label &quot;edge-node&quot; 
    } 
    options {
    buildDiscarder(logRotator(numToKeepStr: '3'))
    disableConcurrentBuilds()
    }
    stages {

        stage('Check'){
            steps {
                sh &quot;mvn sonar:sonar&quot;
            }
        }
        stage('Clean') {
            steps {
               sh &quot;mvn clean&quot;
            }
        }
        stage('Build') {
            steps {
                sh &quot;mvn compile&quot;
            }
        }
        stage('Package') {
            steps {
                sh &quot;mvn package -Dmaven.test.skip=true -P&quot;+env.BRANCH_NAME
            }
        }
        stage('Deploy') {
            steps {
                sh &quot;mvn deploy -Dmaven.test.skip=true -P&quot;+env.BRANCH_NAME
            }
        }

        stage('IN') {
            steps {
                 sh &quot;~/kubectl_update.sh ${env.WORKSPACE} ${env.JOB_NAME}&quot;
            }
        }
    }
     post {
        success {
            dingTalk(
                robot: 'jenkins', 
                type:'MARKDOWN', 
                title: &quot;æ„å»ºæˆåŠŸ: ${JOB_NAME}&quot;, 
                text: [&quot;## [${JOB_NAME}](${JOB_URL})&quot;,
                       &quot;---&quot;,
                       &quot;- ä»»åŠ¡: [${BUILD_DISPLAY_NAME}](${BUILD_URL})&quot;,
                       &quot;- çŠ¶æ€: &lt;font color=green&gt;æˆåŠŸ&lt;/font&gt;&quot;,
                       &quot;- æŒç»­æ—¶é—´: ${currentBuild.durationString}&quot;,	],	
            )
        }
        failure {
            dingTalk(
                robot: 'jenkins', 
                type:'MARKDOWN', 
                title: &quot;æ„å»ºå¤±è´¥: ${JOB_NAME}&quot;, 
                text: [&quot;## [${JOB_NAME}](${JOB_URL})&quot;,
                       &quot;---&quot;,
                       &quot;- ä»»åŠ¡: [${BUILD_DISPLAY_NAME}](${BUILD_URL})&quot;,
                       &quot;- çŠ¶æ€: &lt;font color=red&gt;å¤±è´¥&lt;/font&gt;&quot;,
                       &quot;- æŒç»­æ—¶é—´: ${currentBuild.durationString}&quot;,	],		
            ) 
        }
    }
}
</code></pre>
<h6 id="å‰ç«¯é¡¹ç›®æ„å»ºpipelineç¤ºä¾‹">å‰ç«¯é¡¹ç›®æ„å»ºpipelineç¤ºä¾‹</h6>
<pre><code>pipeline {
    agent {
        label &quot;edge-node&quot;
    }

    stages {

        stage('Check'){
            steps {
                sh &quot;~/sonar-scanner-4.7.0.2747-linux/bin/sonar-scanner -Dsonar.login=admin -Dsonar.password=finsi0t.c0m&quot; 
            }
        }
        stage('Clean') {
            steps {
               sh &quot;npm cache clean --force&quot;
            }
        }
        stage('Build') {
            steps {
                sh &quot;npm install &amp;&amp; npm run build:pro&quot;
            }
        }
        stage('Install') {
            steps {
               sh &quot;~/kubectl_update.sh ${env.WORKSPACE} ${env.JOB_NAME}&quot;
            } 
        }


    }
    options {
        buildDiscarder(logRotator(numToKeepStr: '3'))
        disableConcurrentBuilds()
    }
     post {
        success {
            dingTalk(
                robot: 'jenkins', 
                type:'MARKDOWN', 
                title: &quot;æ„å»ºæˆåŠŸ: ${JOB_NAME}&quot;, 
                text: [&quot;## [${JOB_NAME}](${JOB_URL})&quot;,
                       &quot;---&quot;,
                       &quot;- ä»»åŠ¡: [${BUILD_DISPLAY_NAME}](${BUILD_URL})&quot;,
                       &quot;- çŠ¶æ€: &lt;font color=green&gt;æˆåŠŸ&lt;/font&gt;&quot;,
                       &quot;- æŒç»­æ—¶é—´: ${currentBuild.durationString}&quot;,	],	
            )
        }
        failure {
            dingTalk(
                robot: 'jenkins', 
                type:'MARKDOWN', 
                title: &quot;æ„å»ºå¤±è´¥: ${JOB_NAME}&quot;, 
                text: [&quot;## [${JOB_NAME}](${JOB_URL})&quot;,
                       &quot;---&quot;,
                       &quot;- ä»»åŠ¡: [${BUILD_DISPLAY_NAME}](${BUILD_URL})&quot;,
                       &quot;- çŠ¶æ€: &lt;font color=red&gt;å¤±è´¥&lt;/font&gt;&quot;,
                       &quot;- æŒç»­æ—¶é—´: ${currentBuild.durationString}&quot;,	],		
            ) 
        }
    }
}
</code></pre>
<h4 id="åˆ›å»ºæµæ°´çº¿é¡¹ç›®">åˆ›å»ºæµæ°´çº¿é¡¹ç›®</h4>
<figure data-type="image" tabindex="16"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216152357088.png" alt="image-20230216152357088" loading="lazy"></figure>
<figure data-type="image" tabindex="17"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216152342895.png" alt="image-20230216152342895" loading="lazy"></figure>
<figure data-type="image" tabindex="18"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216153134214.png" alt="image-20230216153134214" loading="lazy"></figure>
<p>è¿™é‡Œpipelineæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨jenkinsä¸Šé¢å†™ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯æ¥è‡ªä»“åº“çš„pipelineæ–‡ä»¶ï¼Œå¦‚ä¸Šå›¾ã€‚é»˜è®¤è„šæœ¬æ–‡ä»¶è·¯å¾„æ˜¯ä»£ç é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„Jenkinsfileã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘è¿™é‡Œgitlabå­˜æ”¾çš„ç”¨äºæµ‹è¯•çš„jenkinsfileï¼š</p>
<figure data-type="image" tabindex="19"><img src="https://koko-club.github.io/post-images/jenkins/image-20230216164244800.png" alt="image-20230216164244800" loading="lazy"></figure>
<p>jenkinsfile(pipeline)å’Œjenkinsæµæ°´çº¿é…ç½®å®Œæˆä¹‹åå°±å¯ä»¥æ‰§è¡Œä»»åŠ¡äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„gitæ‹‰å–ä»“åº“åªèƒ½å†™åœ¨pipelineä¸­ï¼Œä¸èƒ½åƒè‡ªç”±é£æ ¼å’Œmavené£æ ¼ä»»åŠ¡ä¸€æ ·åœ¨ä»»åŠ¡é…ç½®ä¸­è®¾ç½®æºç ç®¡ç†ï¼ˆgitï¼‰ã€‚è¿™é‡Œé’©å­è§¦å‘çš„é…ç½®å’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æ„å»ºåé€šçŸ¥æ˜¯å†™åœ¨pipelineä¸­çš„ï¼Œä¸‹é¢çš„å¤šåˆ†æ”¯æµæ°´çº¿ä¼šå†™ã€‚</p>
<h5 id="jenkinsä¸­çš„æµæ°´çº¿è¯­æ³•ç”Ÿæˆå™¨">jenkinsä¸­çš„æµæ°´çº¿è¯­æ³•ç”Ÿæˆå™¨</h5>
<p>å¦‚æœä¸ç†Ÿæ‚‰æµæ°´çº¿è¯­æ³•å¯ä»¥åœ¨é…ç½®ä»»åŠ¡ä¸­é€‰æ‹©æµæ°´çº¿è¯­æ³•ï¼Œè·³è½¬åˆ°è¯­æ³•ç”Ÿæˆå™¨ã€‚</p>
<figure data-type="image" tabindex="20"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217104911232.png" alt="image-20230217104911232" loading="lazy"></figure>
<figure data-type="image" tabindex="21"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217104951115.png" alt="image-20230217104951115" loading="lazy"></figure>
<p>ä¾‹å¦‚æˆ‘è¿™é‡Œç”Ÿæˆä¸€ä¸ªgitæ‹‰å–ä»£ç çš„pipelineç‰‡æ®µ</p>
<figure data-type="image" tabindex="22"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217105413932.png" alt="image-20230217105413932" loading="lazy"></figure>
<h4 id="å¤šåˆ†æ”¯æµæ°´çº¿">å¤šåˆ†æ”¯æµæ°´çº¿</h4>
<p>å¤šåˆ†æ”¯æµæ°´çº¿å’Œæµæ°´çº¿ä¸åŒçš„åœ°æ–¹æ˜¯å¤šåˆ†æ”¯æµæ°´çº¿å¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ªé¡¹ç›®å¤šä¸ªåˆ†æ”¯è¿›è¡Œä»»åŠ¡ã€‚åœ¨å®é™…ä¸­ï¼Œéœ€è¦å¤šåˆ†æ”¯åŒæ—¶è¿›è¡Œå¼€å‘ã€‚å¦‚æœæ¯ä¸ªåˆ†æ”¯éƒ½åˆ›å»ºä¸€ä¸ªJenkinsé¡¹ç›®ï¼Œæ¯”è¾ƒå¤šä½™ã€‚ä¸€èˆ¬ä¼ä¸šç”Ÿäº§ä¸­ä¹Ÿä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</p>
<figure data-type="image" tabindex="23"><img src="https://koko-club.github.io/post-images/jenkins/63e1c8cfbe940700149b78e776a5f7e0.png" alt="img" loading="lazy"></figure>
<p>æ–°å»ºä»»åŠ¡ä¸­é€‰æ‹©å¤šåˆ†æ”¯æµæ°´çº¿</p>
<figure data-type="image" tabindex="24"><img src="https://koko-club.github.io/post-images/jenkins/image-1607389282641.png" alt="file" loading="lazy"></figure>
<h5 id="åˆ†æ”¯æºé…ç½®">åˆ†æ”¯æºé…ç½®</h5>
<p>å¡«å…¥gité¡¹ç›®åœ°å€ä»¥åŠç™»å½•å‡­æ®ï¼Œæ·»åŠ è¡Œä¸ºclean before/after checkout ç”¨äºæ¸…ç†æœªè·Ÿè¸ªçš„æ–‡ä»¶</p>
<figure data-type="image" tabindex="25"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217101740905.png" alt="image-20230217101740905" loading="lazy"></figure>
<h5 id="build-configuration">build configuration</h5>
<p>å¦‚æœæ˜¯ä»“åº“æ ¹ç›®å½•ä¸‹çš„jenkinsfileå°±ç”¨é»˜è®¤å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é¡¹ç›®ä¸‹éœ€è¦æ‰§è¡Œjenkinsä»»åŠ¡çš„åˆ†æ”¯éƒ½éœ€è¦æœ‰jenkinsfileï¼Œæ¯ä¸ªåˆ†æ”¯çš„jenkinsfileæ˜¯ç‹¬ç«‹çš„ã€‚</p>
<figure data-type="image" tabindex="26"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217101839957.png" alt="image-20230217101839957" loading="lazy"></figure>
<h5 id="æ‰«æ-å¤šåˆ†æ”¯æµæ°´çº¿-è§¦å‘å™¨">æ‰«æ å¤šåˆ†æ”¯æµæ°´çº¿ è§¦å‘å™¨</h5>
<p>å¤šåˆ†æ”¯æµæ°´çº¿é’©å­è§¦å‘å™¨éœ€è¦ä¸‹è½½æ’ä»¶ï¼šMultibranch Scan Webhook Triggerã€‚</p>
<p>å®‰è£…å®Œä»¥ååœ¨æ‰«æ å¤šåˆ†æ”¯æµæ°´çº¿ è§¦å‘å™¨ä¸­é€‰æ‹©scan by webhookï¼Œè¾“å…¥trigger tokenã€‚ä¾‹å¦‚è¿™é‡Œè¾“å…¥çš„æ˜¯testï¼Œåˆ™gitlabé‚£è¾¹è®¾ç½®è§¦å‘é’©å­é…ç½®çš„urlå°±åº”è¯¥æ˜¯</p>
<p>http(s)ğŸ˜•/JENKINS_URL/multibranch-webhook-trigger/invoke?token=test</p>
<figure data-type="image" tabindex="27"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217103028959.png" alt="image-20230217103028959" loading="lazy"></figure>
<p>é…ç½®å®Œä¿å­˜ä»¥åä¼šè‡ªåŠ¨å¼€å§‹æ‰«æå¤šåˆ†æ”¯</p>
<figure data-type="image" tabindex="28"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217103434365.png" alt="image-20230217103434365" loading="lazy"></figure>
<p>ç”±äºæˆ‘è¿™é‡Œæœ‰ä¸¤ä¸ªåˆ†æ”¯mianã€masteré…ç½®äº†jenkinsfileï¼Œåˆ™è¿™ä¸¤ä¸ªåˆ†æ”¯å¯ä»¥æ„å»ºä»»åŠ¡</p>
<figure data-type="image" tabindex="29"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217103520226.png" alt="image-20230217103520226" loading="lazy"></figure>
<figure data-type="image" tabindex="30"><img src="https://koko-club.github.io/post-images/jenkins/image-20230217103531928.png" alt="image-20230217103531928" loading="lazy"></figure>
<p>å¤šåˆ†æ”¯å’Œé’©å­è§¦å‘å™¨éƒ½é…ç½®å®Œæ¯•åï¼Œåœ¨gitä»“åº“é‚£è¾¹å¯¹å¯¹åº”åˆ†æ”¯è¿›è¡Œpushæ“ä½œï¼Œè¿™è¾¹å°±ä¼šè‡ªåŠ¨å¼€å§‹æ„å»ºä»»åŠ¡</p>
<h2 id="å®‰å…¨">å®‰å…¨</h2>
<p>å®‰å…¨é…ç½®ä½äºï¼šç³»ç»Ÿé…ç½®-ã€‹å®‰å…¨å…¨å±€é…ç½®</p>
<h3 id="å‡­æ®">å‡­æ®</h3>
<p>è¿™ä¸ªä¸Šé¢åœ¨gitæ‹‰å–æ—¶å·²ç»ç”¨åˆ°è¿‡äº†ï¼Œå°±ä¸è¯¦ç»†è®²è¿°äº†ã€‚å°±æ˜¯å­˜æ”¾å¯†é’¥æˆ–è€…è´¦å·å¯†ç çš„æ¨¡å—ï¼Œåœ¨ç³»ç»Ÿç®¡ç†-ã€‹å‡­æ®ç®¡ç†ä¸­å¯ä»¥é…ç½®ï¼ˆé…ç½®ä»»åŠ¡æ—¶ä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ å‡­æ®ï¼‰ã€‚</p>
<h3 id="å®‰å…¨åŸŸ">å®‰å…¨åŸŸ</h3>
<p>å®‰å…¨åŸŸä¸»è¦æ˜¯å®šä¹‰jenkinsç”¨æˆ·çš„æ•°æ®æºï¼Œé»˜è®¤æ˜¯ Jenkinsè‡ªå¸¦çš„ç”¨æˆ·æ•°æ®åº“ã€‚</p>
<p>é…ç½®è·¯å¾„ï¼šjenkinsè®¾ç½®-ã€‹å…¨å±€å®‰å…¨é…ç½®-å®‰å…¨åŸŸ</p>
<p>è¿™ä¸ªä¸€èˆ¬ä½¿ç”¨é»˜è®¤é¡¹å°±è¡Œï¼Œå¦‚æœæœ‰ldapé…ç½®éœ€æ±‚ä¹Ÿå¯ä»¥é€‰æ‹©ldapï¼ˆç”¨æˆ·æ•°æ®ä½¿ç”¨ldapçš„æ•°æ®åº“ï¼‰ã€‚</p>
<h3 id="æˆæƒç­–ç•¥">æˆæƒç­–ç•¥</h3>
<h4 id="ç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹">ç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹</h4>
<p>æˆæƒç­–ç•¥é»˜è®¤æ˜¯â€œç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹â€œï¼Œè¡¨ç¤ºç™»å½•ç”¨æˆ·çš†ä¸ºæœ€é«˜æƒé™ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå­é€‰é¡¹æ˜¯â€åŒ¿åç”¨æˆ·å…·æœ‰å¯è¯»æƒé™â€œï¼Œä¸€èˆ¬ä¼šé…åˆå­é€‰é¡¹è¿›è¡Œä½¿ç”¨ã€‚ï¼ˆç™»å½•çš„æ˜¯ç®¡ç†å‘˜ï¼Œä¸ç™»é™†å°±åªæœ‰åªè¯»æƒé™ï¼‰</p>
<h4 id="ä»»ä½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹æ²¡æœ‰ä»»ä½•é™åˆ¶">ä»»ä½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹(æ²¡æœ‰ä»»ä½•é™åˆ¶)</h4>
<p>ç®€æ˜çŸ¥æ„ï¼Œæ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬åŒ¿åç”¨æˆ·ï¼‰éƒ½æœ‰æœ€é«˜æƒé™ã€‚ä¸€èˆ¬ä¸ç”¨</p>
<h4 id="å®‰å…¨çŸ©é˜µå’Œé¡¹ç›®çŸ©é˜µæˆæƒç­–ç•¥">å®‰å…¨çŸ©é˜µå’Œé¡¹ç›®çŸ©é˜µæˆæƒç­–ç•¥</h4>
<p>æ ¹æ®ç”¨æˆ·æˆ–ç”¨æˆ·ç»„æˆäºˆå¯¹åº”æƒé™ï¼Œå¯ä»¥ç²¾ç¡®åˆ°å…·ä½“æ¨¡å—æƒé™ï¼Œä½†ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªæ›´å¥½çš„æ¨¡å—Role-Based Strategyä½œä¸ºæ›¿ä»£ã€‚</p>
<h4 id="role-based-strategy">Role-Based Strategy</h4>
<p>è§’è‰²æˆæƒæ¨¡å—ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç­–ç•¥ï¼Œéœ€è¦å…ˆä¸‹è½½æ¨¡å—<a href="https://plugins.jenkins.io/role-strategy">Role-based Authorization Strategy</a>ã€‚</p>
<p>åº”ç”¨Role-Based Strategyä»¥åï¼Œé€‰æ‹© ç³»ç»Ÿç®¡ç†-ã€‹å®‰å…¨-ã€‹Manage and Assign Roles</p>
<h5 id="ç®¡ç†è§’è‰²">ç®¡ç†è§’è‰²</h5>
<p>ä½äºç³»ç»Ÿç®¡ç†-ã€‹å®‰å…¨-ã€‹Manage and Assign Roles-ã€‹ç®¡ç†è§’è‰²</p>
<p>ç®¡ç†è§’è‰²ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯åˆ›å»ºä¸€ä¸ªè§’è‰²ï¼Œå¹¶å¯¹äºè§’è‰²æˆäºˆæƒé™ï¼Œç„¶åå°†è§’è‰²èµ‹äºˆç”¨æˆ·æˆ–ç”¨æˆ·ç»„</p>
<h6 id="global-roles">Global roles</h6>
<p>å…¨å±€ç®¡ç†ï¼Œå¯ä»¥å¯¹ç”¨æˆ·æˆ–ç»„æˆäºˆæƒé™ï¼ˆè¾“å…¥ç”¨æˆ· addä»¥åé€šè¿‡é€‰æ‹©æ‰“å‹¾æˆäºˆå¯¹åº”æ¨¡å—æƒé™ï¼Œç„¶åä¿å­˜ç”Ÿæ•ˆï¼‰ã€‚<img src="https://koko-club.github.io/post-images/jenkins/image-20230220153651762.png" alt="image-20230220153651762" loading="lazy"></p>
<figure data-type="image" tabindex="31"><img src="https://koko-club.github.io/post-images/jenkins/image-20230220153700562.png" alt="image-20230220153700562" loading="lazy"></figure>
<h6 id="item-roles">Item roles</h6>
<p>é€šè¿‡é¡¹ç›®è¿›è¡Œæˆæƒï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™åŒ¹é…ã€‚ä¾‹å¦‚æˆ‘è¿™é‡Œæ˜¯æˆäºˆæœ‰è‹±æ–‡å­—æ¯a-zçš„é¡¹ç›®æƒé™</p>
<figure data-type="image" tabindex="32"><img src="post-images/jenkins/image-20230220160917798.png" alt="image-20230220160917798" loading="lazy"></figure>
<h6 id="node-roles">Node roles</h6>
<p>Node rolesåœ¨Jenkinsé›†ç¾¤ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œé…ç½®ä¸åŒç»“ç‚¹çš„Jenkinsæƒé™ã€‚ï¼ˆç›®å‰æ²¡ä½¿ç”¨è¿‡ï¼Œå¦‚åæœŸæœ‰ä½¿ç”¨ä¼šè¡¥ä¸Šè¿™ä¸€å—å†…å®¹ï¼‰</p>
<h5 id="åˆ†é…è§’è‰²">åˆ†é…è§’è‰²</h5>
<p>åˆ†é…è§’è‰²ä¹Ÿæ˜¯ä¸‰å¤§å—ï¼šGlobal rolesã€Item rolesã€Node rolesã€‚åˆ†é…ä¸»è¦å°±æ˜¯æ·»åŠ ç”¨æˆ·ã€ç”¨æˆ·ç»„ç„¶åå‹¾é€‰ä¸Šé¢åˆ›å»ºå¥½çš„è§’è‰²ï¼Œæ­¤æ—¶ç”¨æˆ·ã€ç”¨æˆ·ç»„åˆ™æ‹¥æœ‰äº†è¯¥è§’è‰²çš„æƒé™ã€‚</p>
<p>å¤‡æ³¨ï¼šjenkinsé»˜è®¤æ²¡æœ‰ç»„é€‰é¡¹ï¼Œåªèƒ½é€šè¿‡active directoryæˆ–è€…ldapå¯¹æ¥jenkinsç”¨æˆ·æ•°æ®æ¥ä½¿ç”¨ç”¨æˆ·ç»„ç®¡ç†ã€‚</p>
<h2 id=""></h2>
<h2 id="å…¶ä»–é—®é¢˜">å…¶ä»–é—®é¢˜</h2>
<h3 id="k8sç¯å¢ƒä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜">k8sç¯å¢ƒä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜</h3>
<h4 id="æ—¶åŒº">æ—¶åŒº</h4>
<p>æ—¶åŒºé»˜è®¤è‚¯å®šä¸æ˜¯å›½å†…çš„ï¼Œæœ€ç®€ä¾¿çš„è§£å†³æ–¹æ³•æ˜¯é€šè¿‡æŒ‚è½½ä¸»æœºï¼ˆk8s hostpathæ–¹æ³•ï¼‰çš„æ—¶åŒºæ–‡ä»¶(/etc/localtime)è§£å†³ã€‚æˆ–è€…dockerfileç”¨jenkinsä½œä¸ºåŸºç¡€é•œåƒï¼Œå†åŠ ä¸Šæ—¶åŒºä¿®æ”¹çš„é…ç½®ä¹Ÿå¯ä»¥ã€‚</p>
<h4 id="ä¸­æ–‡ä¹±ç ">ä¸­æ–‡ä¹±ç </h4>
<p>è¿™ä¸ªæ˜¯ä¸æ˜¯k8séƒ½æœ‰å¯èƒ½å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦æ˜¯ä¸»æœºçš„å­—ç¬¦é›†æ ¼å¼éœ€è¦ä¿®æ”¹ä¸ºä¸­æ–‡utf-8ã€‚å¦‚æœæ˜¯k8sçš„è¯éœ€è¦dockerfileé‡æ–°æ‰“ä¸€ä¸‹é•œåƒï¼Œæ”¹æˆä¸­æ–‡utf-8ï¼Œæˆ–è€…æ¯æ¬¡å¯åŠ¨æ—¶å®‰è£…utf-8ä¸­æ–‡å¹¶é…ç½®ï¼ˆä¸€èˆ¬jenkinsé•œåƒæ²¡æœ‰ä¸­æ–‡utf-8ï¼‰</p>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li><a href="#jenkins">jenkins</a>
<ul>
<li><a href="#%E4%BB%8B%E7%BB%8D">ä»‹ç»</a>
<ul>
<li><a href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90ci">æŒç»­é›†æˆCI</a></li>
<li><a href="#%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98cd">æŒç»­äº¤ä»˜CD</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2">éƒ¨ç½²</a>
<ul>
<li><a href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E9%83%A8%E7%BD%B2">äºŒè¿›åˆ¶åŒ…éƒ¨ç½²</a></li>
<li><a href="#k8sdocker%E9%83%A8%E7%BD%B2">k8s(docker)éƒ¨ç½²</a>
<ul>
<li><a href="#docker%E9%83%A8%E7%BD%B2">dockeréƒ¨ç½²</a></li>
<li><a href="#k8s%E9%83%A8%E7%BD%B2">k8séƒ¨ç½²</a>
<ul>
<li><a href="#helm%E6%96%B9%E5%BC%8F">helmæ–¹å¼</a></li>
<li><a href="#yaml%E9%83%A8%E7%BD%B2">yamléƒ¨ç½²</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E4%BB%BB%E5%8A%A1">ä»»åŠ¡</a>
<ul>
<li><a href="#%E9%9D%9E%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%87%AA%E7%94%B1%E9%A3%8E%E6%A0%BC">éæµæ°´çº¿ï¼ˆè‡ªç”±é£æ ¼ï¼‰</a>
<ul>
<li><a href="#%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81">æ‹‰å–ä»£ç </a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8">æ„å»ºè§¦å‘å™¨</a>
<ul>
<li><a href="#webhook%E8%A7%A6%E5%8F%91jenkins%E4%BB%BB%E5%8A%A1%E9%85%8D%E7%BD%AE">webhookè§¦å‘jenkinsä»»åŠ¡é…ç½®</a></li>
</ul>
</li>
<li><a href="#%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83">æ„å»ºç¯å¢ƒ</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA">æ„å»º</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E5%90%8E%E6%93%8D%E4%BD%9C">æ„å»ºåæ“ä½œ</a>
<ul>
<li><a href="#%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5">ä¼ä¸šå¾®ä¿¡é€šçŸ¥</a></li>
<li><a href="#%E9%92%89%E9%92%89%E9%80%9A%E7%9F%A5">é’‰é’‰é€šçŸ¥</a></li>
</ul>
</li>
<li><a href="#maven%E4%BB%BB%E5%8A%A1">mavenä»»åŠ¡</a></li>
</ul>
</li>
<li><a href="#%E6%B5%81%E6%B0%B4%E7%BA%BFpipeline">æµæ°´çº¿ï¼ˆpipelineï¼‰</a>
<ul>
<li><a href="#pipeline%E8%AF%AD%E6%B3%95">pipelineè¯­æ³•</a>
<ul>
<li><a href="#pipeline%E7%A4%BA%E4%BE%8B">pipelineç¤ºä¾‹</a>
<ul>
<li><a href="#%E7%A4%BA%E4%BE%8B1">ç¤ºä¾‹1</a></li>
<li><a href="#java%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BApipeline%E7%A4%BA%E4%BE%8B">javaé¡¹ç›®æ„å»ºpipelineç¤ºä¾‹</a></li>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BApipeline%E7%A4%BA%E4%BE%8B">å‰ç«¯é¡¹ç›®æ„å»ºpipelineç¤ºä¾‹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%B5%81%E6%B0%B4%E7%BA%BF%E9%A1%B9%E7%9B%AE">åˆ›å»ºæµæ°´çº¿é¡¹ç›®</a>
<ul>
<li><a href="#jenkins%E4%B8%AD%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%AD%E6%B3%95%E7%94%9F%E6%88%90%E5%99%A8">jenkinsä¸­çš„æµæ°´çº¿è¯­æ³•ç”Ÿæˆå™¨</a></li>
</ul>
</li>
<li><a href="#%E5%A4%9A%E5%88%86%E6%94%AF%E6%B5%81%E6%B0%B4%E7%BA%BF">å¤šåˆ†æ”¯æµæ°´çº¿</a>
<ul>
<li><a href="#%E5%88%86%E6%94%AF%E6%BA%90%E9%85%8D%E7%BD%AE">åˆ†æ”¯æºé…ç½®</a></li>
<li><a href="#build-configuration">build configuration</a></li>
<li><a href="#%E6%89%AB%E6%8F%8F-%E5%A4%9A%E5%88%86%E6%94%AF%E6%B5%81%E6%B0%B4%E7%BA%BF-%E8%A7%A6%E5%8F%91%E5%99%A8">æ‰«æ å¤šåˆ†æ”¯æµæ°´çº¿ è§¦å‘å™¨</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%AE%89%E5%85%A8">å®‰å…¨</a>
<ul>
<li><a href="#%E5%87%AD%E6%8D%AE">å‡­æ®</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E5%9F%9F">å®‰å…¨åŸŸ</a></li>
<li><a href="#%E6%8E%88%E6%9D%83%E7%AD%96%E7%95%A5">æˆæƒç­–ç•¥</a>
<ul>
<li><a href="#%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%BB%E4%BD%95%E4%BA%8B">ç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹</a></li>
<li><a href="#%E4%BB%BB%E4%BD%95%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%BB%E4%BD%95%E4%BA%8B%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E9%99%90%E5%88%B6">ä»»ä½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹(æ²¡æœ‰ä»»ä½•é™åˆ¶)</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E7%9F%A9%E9%98%B5%E5%92%8C%E9%A1%B9%E7%9B%AE%E7%9F%A9%E9%98%B5%E6%8E%88%E6%9D%83%E7%AD%96%E7%95%A5">å®‰å…¨çŸ©é˜µå’Œé¡¹ç›®çŸ©é˜µæˆæƒç­–ç•¥</a></li>
<li><a href="#role-based-strategy">Role-Based Strategy</a>
<ul>
<li><a href="#%E7%AE%A1%E7%90%86%E8%A7%92%E8%89%B2">ç®¡ç†è§’è‰²</a>
<ul>
<li><a href="#global-roles">Global roles</a></li>
<li><a href="#item-roles">Item roles</a></li>
<li><a href="#node-roles">Node roles</a></li>
</ul>
</li>
<li><a href="#%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2">åˆ†é…è§’è‰²</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li></li>
<li><a href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98">å…¶ä»–é—®é¢˜</a>
<ul>
<li><a href="#k8s%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98">k8sç¯å¢ƒä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜</a>
<ul>
<li><a href="#%E6%97%B6%E5%8C%BA">æ—¶åŒº</a></li>
<li><a href="#%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81">ä¸­æ–‡ä¹±ç </a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

</div></section>
</div></div></div><script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
</script>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>Copyright Â© 2018-2020 <a href="https://koko-club.github.io" style="margin:0;">Imcry</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_uv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>5</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://koko-club.github.io/media/js/prism.js"></script>
</body>
</html>